load("@fbcode//quic:defs.bzl", "mvfst_cpp_library")

oncall("traffic_protocols")

mvfst_cpp_library(
    name = "fizz_handshake",
    srcs = [
        "FizzCryptoFactory.cpp",
        "FizzPacketNumberCipher.cpp",
        "FizzRetryIntegrityTagGenerator.cpp",
        "QuicFizzFactory.cpp",
    ],
    headers = [
        "FizzCryptoFactory.h",
        "FizzPacketNumberCipher.h",
        "FizzRetryIntegrityTagGenerator.h",
        "FizzTransportParameters.h",
        "QuicFizzFactory.h",
    ],
    deps = [
        ":fizz_bridge",
        "//fizz/backend:openssl",
        "//fizz/crypto:crypto",
        "//fizz/crypto:utils",
        "//fizz/crypto/aead:aead",
        "//quic/common:optional",
    ],
    exported_deps = [
        "//fizz/protocol:default_factory",
        "//fizz/record:record",
        "//folly/ssl:openssl_ptr_types",
        "//quic/codec:packet_number_cipher",
        "//quic/common:buf_util",
        "//quic/common:mvfst_logging",
        "//quic/fizz/handshake:fizz_bridge",
        "//quic/folly_utils:folly_utils",
        "//quic/handshake:handshake",
        "//quic/handshake:retry_integrity_tag_generator",
        "//quic/handshake:transport_parameters",
    ] + select({
        "DEFAULT": [],
        "ovr_config//runtime/constraints:fbcode": select({
            "DEFAULT": ["fbcode//quic/facebook/handshake:xsec_crypto_bridge"],  # @fb-only
            "ovr_config//build_mode:arvr_mode": [],  # @fb-only
            "ovr_config//runtime/constraints:android-host-test": [],  # @fb-only
        }),  # @fb-only
    }),
)

mvfst_cpp_library(
    name = "fizz_bridge",
    srcs = [
        "FizzBridge.cpp",
    ],
    headers = [
        "FizzBridge.h",
    ],
    exported_deps = [
        "//fizz/crypto/aead:aead",
        "//fizz/protocol:types",
        "//quic:constants",
        "//quic/handshake:aead",
        "//quic/handshake:handshake",
    ],
)
